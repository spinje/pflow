Another important thing to consider is that template variable substitution would need to happen after the proxy mapping has been done. This is because if the proxy mapping is renaming shared store keys that are duplicated, before this is done, the template variable would reference multiple keys. This is an important detail for the implementation of the proxy mapping as well as the planner. We should probably have a separate step in the planner that is focused ONLY on creating shared store proxy mappings first and then the template variable substitution step. Keeping them as separate steps would reduce the risk of the planner making mistakes, keeping the LLM focused on a single concept at a time. What do you think? Take your time to ultrathink about this. Lets take a step back and really consider our options.

Im also thinking that the best way to determine if we could SKIP the proxy mapping step is to have the read/writes to shared store being visible in the node json ir, then we can just check if there are any duplicate keys in the shared store. If there are, we need to do the proxy mapping. If there are no duplicates, we can skip the proxy mapping step. However, im not sure if im missing any important details or edge cases here and if this is a good idea.

Adding read/writes to IR would enable static validation both before and after the proxy mapping step. (before to see if the proxy mapping is needed, after to see if the proxy mapping was successful)

With all this said, maybe it is to much complexity to do this as separate steps for mvp, we should validate if the LLM struggles with generating workflows first, before we start trying to solve problems we dont know exists yet. However, inlcuding special instructions to the prompt (only in cases proxy mappings are needed) could be a good idea. Adding instructions to do something when its actually not needed could confuse the LLM and make it less accurate. I'm also anticipating that for many workflows, the proxy mapping step will be skipped.
