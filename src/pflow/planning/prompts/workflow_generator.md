---
name: workflow_generator
test_path: tests/test_planning/llm/prompts/test_generator_prompts.py::TestGeneratorPromptEffectiveness
test_command: uv run python tools/test_prompt_accuracy.py workflow_generator
version: 1.0
latest_accuracy: 0.0
test_runs: []
average_accuracy: 0.0
test_count: 0
previous_version_accuracy: 0.0
last_tested: 2025-01-01
prompt_hash: ""
---

# Workflow Generator Prompt

Generate a workflow for: {{user_input}}

Use the available nodes to create the workflows intermediate representation (IR) in json format.

<available_nodes>
{{planning_context}}
</available_nodes>

CRITICAL Requirements:
1. Use template variables (${variable}) for ALL dynamic values
2. NEVER hardcode values like "1234" - use ${issue_number} instead
3. Generate LINEAR workflow only - no branching
4. Template variables can reference TWO types of data:
   a) USER INPUTS: ${variable_name} (MUST be declared in "inputs" section)
   b) NODE OUTPUTS: ${node_id.output_key} (from previous nodes, NOT declared in "inputs")
5. CRITICAL DISTINCTION - DO NOT CONFUSE THESE:
   - USER INPUTS: Data the user provides to START the workflow (e.g., file path, topic)
     → These go in the "inputs" section with required/default/description
     → Referenced as ${variable_name} in node params
   - NODE OUTPUTS: Data GENERATED by nodes during execution (e.g., LLM response, API data)
     → These are NOT user inputs - do NOT put in "inputs" section
     → Referenced as ${node_id.output_key} (e.g., ${generate_joke.response})
     → Example: If LLM generates content, write-file should use ${llm_node.response} NOT ${content}
6. Create descriptive node IDs (e.g., "fetch_issues", not "n1")
7. Avoid multiple nodes of the same type (causes shared store collision)
8. Every variable in "inputs" MUST be something the USER provides, not generated data!

EXAMPLE showing proper template variable usage:
{
  "ir_version": "0.1.0",
  "nodes": [
    {
      "id": "generate_content",
      "type": "llm",
      "params": {
        "prompt": "Create a joke about ${topic}",  // ← ${topic} is USER INPUT
        "model": "${model_name}"  // ← ${model_name} is USER INPUT with default
      }
    },
    {
      "id": "save_to_file",
      "type": "write-file",
      "params": {
        "content": "${generate_content.response}",  // ← NODE OUTPUT from previous node!
        "file_path": "${output_file}"  // ← ${output_file} is USER INPUT
      }
    }
  ],
  "edges": [{"from": "generate_content", "to": "save_to_file"}],
  "start_node": "generate_content",
  "inputs": { // ← ONLY user-provided values go here, NOT generated content!
    "topic": {  // ← User provides this
      "description": "Topic for the joke",
      "type": "string",
      "required": false,
      "default": "cats"
    },
    "model_name": {  // ← User can override this
      "description": "LLM model to use",
      "type": "string",
      "required": false,
      "default": "gpt-4o-mini"
    },
    "output_file": {  // ← User specifies where to save
      "description": "Path to save the joke",
      "type": "string",
      "required": false,
      "default": "joke.txt"
    }
    // NOTE: No "content" here! Content is GENERATED by generate_content node
  },
  "outputs": {
    "saved_file": {
      "description": "Path where joke was saved",
      "source": "${save_to_file.written}"  // REQUIRED: Maps namespaced value to output
    }
  }
}

Workflow Structure Requirements:
- Must include "ir_version": "0.1.0"
- Must include "inputs" field with parameter specifications
- Each input should have: description, required, type, and optional default
- Use universal defaults only (e.g., 100, not request-specific like 20)
- Rename parameters for clarity (e.g., "filename" -> "input_file")
- IMPORTANT: Every declared workflow input MUST be used as a template variable in node params

CRITICAL - Workflow Outputs with Namespacing:
When declaring workflow outputs, you MUST specify the "source" field to map namespaced node outputs:
- Each output needs: "description" AND "source"
- The "source" field uses template syntax: "${node_id.output_key}"
- This is REQUIRED because nodes write to namespaced locations (not root level)
- Example: If node "generate_story" outputs "response", reference it as "${generate_story.response}"

Output Examples:
{
  "outputs": {
    "story_content": {
      "description": "The generated story",
      "source": "${generate_story.response}"  // Maps from namespaced node output
    },
    "file_path": {
      "description": "Where the file was saved",
      "source": "${save_story.written}"  // Maps from another node's output
    }
  }
}

COMMON MISTAKE TO AVOID:
DON'T declare intermediate data as user inputs! For example:
- WRONG: Declaring "content" as a user input when it's generated by an LLM node
- RIGHT: Reference the LLM output directly as ${llm_node.response}
- WRONG: Asking user to provide data that your workflow generates
- RIGHT: Only ask for starting parameters (file paths, topics, config)

<discovered_parameters>
{{discovered_params_section}}
</discovered_parameters>

<validation_errors>
{{validation_errors_section}}
</validation_errors>